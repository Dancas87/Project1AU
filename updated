#data 
library(tidyverse)
library(dplyr)
library(moments)
library(ggplot2)
library(scales)
wmata <- read.csvwmata <- read.csvwmata <- read.csv("WMATA_DailyRidership_Bus_Rail_2021.08_to_2024.06.csv")
wmata

#subset the data 
subset_wmata <- wmata %>% 
  filter(Station.Name %in% c("Tenleytown-AU", "Foggy Bottom-GWU"),
         Day.of.Week %in% c("Mon", "Fri")) %>% mutate(Total_Traffic = Entries.Or.Boardings + Exits)

subset_wmata

#check variable type
str(subset_wmata$Entries.Or.Boardings)
str(subset_wmata$Exits)
str(subset_wmata$Day.of.Week)
str(subset_wmata$Station.Name)
str(subset_wmata$Holiday)
str(subset_wmata$Total_Traffic)
#Entries and Exits are int | Day of Week, Station Name, and Holiday are chr

#check for missing and duplicate values
colSums(is.na(subset_wmata)) #0 missing
sum(duplicated(subset_wmata)) #0 duplicates

#UNIVARIATE ANALYSIS 
#summary for each variable
#Entries
entries_summary <- subset_wmata %>%
  summarise(
    Freq = n(),
    Min = min(Entries.Or.Boardings, na.rm = TRUE),
    Max = max(Entries.Or.Boardings, na.rm = TRUE),
    Median = median(Entries.Or.Boardings, na.rm = TRUE),
    Mean = mean(Entries.Or.Boardings, na.rm = TRUE),
    SD = sd(Entries.Or.Boardings, na.rm = TRUE),
    Skewness = skewness(Entries.Or.Boardings, na.rm = TRUE)
  )

entries_summary

#Exits
exits_summary <- subset_wmata %>%
  summarise(
    Freq = n(),
    Min = min(Exits, na.rm = TRUE),
    Max = max(Exits, na.rm = TRUE),
    Median = median(Exits, na.rm = TRUE),
    Mean = mean(Exits, na.rm = TRUE),
    SD = sd(Exits, na.rm = TRUE),
    Skewness = skewness(Exits, na.rm = TRUE)
  )

exits_summary

#Total Traffic 
total.traffic_summary <- subset_wmata %>%
  summarise(
    Freq = n(),
    Min = min(Total_Traffic, na.rm = TRUE),
    Max = max(Total_Traffic, na.rm = TRUE),
    Median = median(Total_Traffic, na.rm = TRUE),
    Mean = mean(Total_Traffic, na.rm = TRUE),
    SD = sd(Total_Traffic, na.rm = TRUE),
    Skewness = skewness(Total_Traffic, na.rm = TRUE)
  )

total.traffic_summary

#Day of Week
table(subset_wmata$Day.of.Week)
prop.table(table(subset_wmata$Day.of.Week))
#Station Name
table(subset_wmata$Station.Name)
prop.table(table(subset_wmata$Station.Name))
#Holidays
table(subset_wmata$Holiday)
prop.table(table(subset_wmata$Holiday))

#BIVARIATE ANALYSIS 
#1 - Entries <-> Exits | numeric <-> numeric analysis 

#scatterplot
ggplot(subset_wmata, aes(x = Entries.Or.Boardings, y = Exits)) +
  geom_point(alpha = 0.5, color = "#3D74B6", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "#D25D5D", size = 1) +
  labs(title = "Entries v.s. Exits (Mondays & Fridays)",
       subtitle = "Regression Fit (Red Line)",
       x = "Entries", y = "Exits") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold", size = 13, hjust = 0.5),
        plot.subtitle = element_text(size = 10, color = "#D25D5D", hjust = 0.5),
        axis.title = element_text(face = "bold"))

# Correlation
cor(subset_wmata$Entries.Or.Boardings, subset_wmata$Exits)

#2 - Entries <-> Day of Week | numeric <-> categorical analysis 
# Summary stats 
Total.Traffic_summary <- subset_wmata %>%
  group_by(Day.of.Week) %>%
  summarise(
    Freq = n(),
    Min = min(Total_Traffic, na.rm = TRUE),
    Max = max(Total_Traffic, na.rm = TRUE),
    Median = median(Total_Traffic, na.rm = TRUE),
    Mean = mean(Total_Traffic, na.rm = TRUE),
    SD = sd(Total_Traffic, na.rm = TRUE),
    Skewness = skewness(Total_Traffic, na.rm = TRUE)
  )
Total.Traffic_summary

#3 - Holiday <-> Day of Week | categorical <-> categorical analysis
# Cross-tab of Day of Week and Holiday
day_holiday_tab <- table(subset_wmata$Day.of.Week, subset_wmata$Holiday)
day_holiday_tab

# Row proportions (distribution within each day)
prop.table(day_holiday_tab, margin = 1) * 100

#4 - Station Traffic <-> AU vs GWU | numeric <-> categorical analysis
#merging entries and exits to create a new numeric variable for Total Traffic at the Stations
subset_wmata <- subset_wmata %>% mutate(Total_Traffic = Entries.Or.Boardings + Exits) 
#boxplot
ggplot(subset_wmata, aes(x = Station.Name, y = Total_Traffic, fill = Station.Name)) +
  scale_fill_manual(values = c("Tenleytown-AU" = "#D25D5D", "Foggy Bottom-GWU" = "#3D74B6")) +
  geom_boxplot(alpha = 0.75, outlier.shape = 21, outlier.color = "black", outlier.fill = "white") +
  labs(
    title = "Total Metro Traffic by Station",
    subtitle = "Sum of Entries and Exits at AU and GWU Campus Metro Stops",
    x = "Metro Station",
    y = "Total Traffic"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5, size = 9),
    axis.title = element_text(face = "bold", size = 12),
    legend.position = "none"
  )

#5 - Station Traffic <-> Holidays | numeric <-> categorical analysis 
# Dot Plot

ggplot(subset_wmata, aes(x = Holiday, y = Total_Traffic, color = Holiday)) +
  geom_jitter(width = 0.2, alpha = 0.5, size = 1.5) +
  scale_color_manual(values = c("No" = "#D25D5D", "Yes" = "#3D74B6")) +  
  labs(
    title = "Daily Total Traffic on Holidays vs Non-Holidays",
    x = "Holiday",
    y = "Total Traffic (Entries + Exits)"
  ) +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, size = 9),
        axis.title = element_text(face = "bold", size = 12),
    legend.position = "none")

#6 - Entries <-> Tenleytown AU vs Foggy Bottom GWU | numeric <-> categorical
entries_summary <- subset_wmata %>%
  group_by(Station.Name) %>%
  summarise(
    Freq = n(),
    Min = min(Entries.Or.Boardings, na.rm = TRUE),
    Max = max(Entries.Or.Boardings, na.rm = TRUE),
    Med = median(Entries.Or.Boardings, na.rm = TRUE),
    Mean = mean(Entries.Or.Boardings, na.rm = TRUE),
    SD = sd(Entries.Or.Boardings, na.rm = TRUE),
    Skewness = skewness(Entries.Or.Boardings, na.rm = TRUE)
  )

entries_summary

#7 - Exits <-> Tenleytown AU vs Foggy Bottom GWU | numeric <-> categorical
exits_summary <- subset_wmata %>%
  group_by(Station.Name) %>%
  summarise(
    Freq = n(),
    Min = min(Exits, na.rm = TRUE),
    Max = max(Exits, na.rm = TRUE),
    Med = median(Exits, na.rm = TRUE),
    Mean = mean(Exits, na.rm = TRUE),
    SD = sd(Exits, na.rm = TRUE),
    Skewness = skewness(Exits, na.rm = TRUE)
  )

exits_summary


