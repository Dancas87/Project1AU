#data 
library(tidyverse)
library(dplyr)
library(moments)
library(ggplot2)
wmata <- read.csv("WMATA_DailyRidership_Bus_Rail_2021.08_to_2024.06.csv")
wmata

#subset the data 
subset_wmata <- wmata %>%
  filter(Station.Name %in% c("Tenleytown-AU", "Foggy Bottom-GWU"),
         Day.of.Week %in% c("Mon", "Fri"))
subset_wmata

#check variable type
str(subset_wmata$Entries.Or.Boardings)
str(subset_wmata$Exits)
str(subset_wmata$Day.of.Week)
str(subset_wmata$Station.Name)
str(subset_wmata$Holiday)
#Entries and Exits are int | Day of Week, Station Name, and Holiday are chr

#check for missing and duplicate values
colSums(is.na(subset_wmata)) #0 missing
sum(duplicated(subset_wmata)) #0 duplicates

#UNIVARIATE ANALYSIS 
#summary for each variable
#Entries
entries_summary <- subset_wmata %>%
  summarise(
    Freq = n(),
    Min = min(Entries.Or.Boardings, na.rm = TRUE),
    Max = max(Entries.Or.Boardings, na.rm = TRUE),
    Median = median(Entries.Or.Boardings, na.rm = TRUE),
    Mean = mean(Entries.Or.Boardings, na.rm = TRUE),
    SD = sd(Entries.Or.Boardings, na.rm = TRUE),
    Skewness = skewness(Entries.Or.Boardings, na.rm = TRUE)
  )

entries_summary

#Exits
exits_summary <- subset_wmata %>%
  summarise(
    Freq = n(),
    Min = min(Exits, na.rm = TRUE),
    Max = max(Exits, na.rm = TRUE),
    Median = median(Exits, na.rm = TRUE),
    Mean = mean(Exits, na.rm = TRUE),
    SD = sd(Exits, na.rm = TRUE),
    Skewness = skewness(Exits, na.rm = TRUE)
  )

exits_summary

#Day of Week
table(subset_wmata$Day.of.Week)
prop.table(table(subset_wmata$Day.of.Week))
#Station Name
table(subset_wmata$Station.Name)
prop.table(table(subset_wmata$Station.Name))
#Holidays
table(subset_wmata$Holiday)
prop.table(table(subset_wmata$Holiday))

#BIVARIATE ANALYSIS 
#1 - Entries <-> Exits | numeric <-> numeric analysis 

#scatterplot
ggplot(subset_wmata, aes(x = Entries.Or.Boardings, y = Exits)) +
  geom_point(alpha = 0.5, color = "#3D74B6", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "#D25D5D", size = 1) +
  labs(title = "Entries v.s. Exits (Mondays & Fridays)",
       subtitle = "Regression Fit (Red Line)",
       x = "Entries", y = "Exits") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold", size = 13, hjust = 0.5),
        plot.subtitle = element_text(size = 10, color = "#D25D5D", hjust = 0.5),
        axis.title = element_text(face = "bold"))

# Correlation
cor(subset_wmata$Entries.Or.Boardings, subset_wmata$Exits)

#2 - Entries <-> Day of Week | numeric <-> categorical analysis 
# Summary stats 
day_summary <- subset_wmata %>%
  group_by(Day.of.Week) %>%
  summarise(
    Freq = n(),
    Min = min(Entries.Or.Boardings, na.rm = TRUE),
    Max = max(Entries.Or.Boardings, na.rm = TRUE),
    Median = median(Entries.Or.Boardings, na.rm = TRUE),
    Mean = mean(Entries.Or.Boardings, na.rm = TRUE),
    SD = sd(Entries.Or.Boardings, na.rm = TRUE),
    Skewness = skewness(Entries.Or.Boardings, na.rm = TRUE)
  )
day_summary

#3 - 
